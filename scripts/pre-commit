#!/bin/sh
# R√©cup√®re les fichiers Ocaml ajout√©s ou modifi√©s dans l'index
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ml|mli)$')

# S'il y a aucun fichier Ocaml modifier on quitte
if [ -z "$FILES" ]; then
  exit 0
fi

if ! command -v ocamlformat >/dev/null 2>&1; then
  echo "‚ùå ocamlformat n'est pas install√©."
  echo "üì¶ Installation de ocamlformat..."
  opam install -y ocamlformat

  if ! command -v ocamlformat >/dev/null 2>&1; then
    echo "‚ùå Impossible d'installer ocamlformat. Veuillez l'installer manuellement avec: opam install ocamlformat"
    exit 1
  fi
  echo "‚úÖ ocamlformat install√© avec succ√®s!"
fi


# Formate les fichiers
for file in $FILES; do
  echo "‚Üí Formatage de $file"
  ocamlformat --inplace "$file"
  git add "$file"
done

echo "‚úÖ Formatage termin√©."
exit 0